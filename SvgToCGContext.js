
function main() {
    var paths = [];
    paths['flat'] = "M64.487,0.305c0.283-0.055,1.564-0.392,1.565-0.08c0,0.52,0,1.041,0,1.561c0,2.186,0,4.371,0,6.556c0,3.66,0,7.322,0,10.982c1.654-1.264,3.906-2.539,5.953-1.354c1.831,1.058,2.534,3.125,1.831,5.124c-0.686,1.945-2.305,3.503-3.844,4.783c-1.978,1.647-3.788,3.324-5.506,4.898c0-10.673,0-21.346,0-32.017C64.487,0.605,64.487,0.455,64.487,0.305 M66.053,29.667c1.738-1.915,4.28-4.351,4.491-7.274c0.092-1.27-0.503-2.761-1.883-2.968c-1.021-0.182-2.196,1.011-2.543,1.87c-0.14,0.349-0.065,0.816-0.065,1.184c0,0.934,0,1.867,0,2.801C66.053,26.741,66.053,28.203,66.053,29.667z";
    paths['trebleClef'] = "M18.005,40.702c3.651-0.315,7.122,1.096,9.313,3.975c2.109,2.77,2.815,6.426,2.16,9.789c-0.678,3.474-2.952,6.374-5.963,8.28c-0.757,0.479-1.554,0.896-2.376,1.258c0.166,1.273,0.332,2.545,0.501,3.818c0.307,2.36,0.869,4.826,0.854,7.207c-0.019,3.235-1.106,6.481-4.04,8.283c-2.9,1.78-6.728,1.827-9.619,0.033c-2.957-1.832-5.047-5.547-3.602-8.917c1.442-3.358,5.894-4.426,8.24-1.287c1.32,1.765,1.468,4.46-0.122,6.12c-0.947,0.99-2.787,1.779-4.173,1.248c0.038,1.763,2.806,2.645,4.28,2.591c2.133-0.09,4.229-0.829,5.607-2.471c1.438-1.712,1.852-3.96,1.794-6.115c-0.043-1.644-0.377-3.283-0.616-4.909c-0.24-1.658-0.479-3.314-0.722-4.973c-7.669,1.806-14.747-2.696-17.805-9.461c-1.495-3.303-2.102-7.106-1.469-10.677c0.643-3.627,2.561-6.889,4.889-9.739c2.378-2.913,5.189-5.455,7.991-7.969c0.322-0.289,0.645-0.578,0.965-0.866c0.266-0.236,0.332-0.204,0.269-0.577c-0.049-0.29-0.097-0.58-0.141-0.869c-0.193-1.241-0.349-2.488-0.452-3.739c-0.179-2.194-0.233-4.43-0.015-6.623c0.293-2.926,1.128-5.879,2.384-8.551c0.627-1.333,1.391-2.642,2.413-3.729c0.72-0.768,1.887-1.78,3.026-1.832c0.725-0.033,1.272,0.942,1.565,1.45c0.666,1.151,1.124,2.42,1.521,3.679c0.926,2.944,1.588,6.116,1.514,9.208c-0.092,3.833-1.412,7.671-3.366,10.974c-1.028,1.735-2.254,3.357-3.637,4.839c-0.668,0.714-1.374,1.395-2.107,2.042c-0.356,0.313-0.047,1.199,0.014,1.653c0.096,0.697,0.188,1.392,0.281,2.087C17.577,37.522,17.793,39.111,18.005,40.702 M17.177,46.504c-3.562,0.835-6.433,4.767-5.283,8.322c0.252,0.78,0.702,1.485,1.271,2.083c0.291,0.304,0.608,0.581,0.944,0.833c0.384,0.285,0.894,0.486,1.239,0.803c0.279,0.255,0.172,0.673-0.166,0.817c-0.396,0.171-0.849-0.156-1.185-0.337c-0.833-0.448-1.59-1.023-2.245-1.694c-2.626-2.688-3.488-6.789-2.001-10.226c0.762-1.757,2.025-3.315,3.567-4.485c0.711-0.54,1.491-1.001,2.324-1.341c0.198-0.081,0.402-0.157,0.608-0.223c0.345-0.112,0.166-0.356,0.126-0.664c-0.093-0.7-0.185-1.4-0.276-2.101c-0.209-1.6-0.418-3.201-0.629-4.802C9.71,37.953,3.126,43.595,3.271,51.424c0.133,7.017,6.725,12.518,13.854,11.962c0.653-0.051,1.3-0.157,1.935-0.312c0.464-0.114,0.211-0.571,0.16-0.969c-0.053-0.399-0.104-0.798-0.159-1.198c-0.209-1.598-0.417-3.197-0.629-4.794C18.014,52.91,17.594,49.707,17.177,46.504 M24.401,10.783c0.065-1.904-1.371-4.025-3.523-3.233c-1.682,0.619-2.774,2.243-3.521,3.751c-2.039,4.133-2.262,8.636-1.479,13.101C20.174,21.168,24.23,16.3,24.401,10.783 M20.941,62.575c3.579-1.722,5.89-5.684,5.22-9.563c-0.628-3.616-3.596-6.402-7.401-6.605C19.485,51.797,20.211,57.187,20.941,62.575z";
    paths['sharp'] = 'M46.464,22.104c-1.141,0.24-2.277,0.465-3.418,0.671c-0.42,0.075-0.182,2.725-0.182,3.016c0,2.233,0,4.467,0,6.701c0,0.06,0.049,0.37-0.043,0.365c-0.271-0.004-1.604,0.062-1.754-0.093c-0.297-0.288,0-4.732,0-5.073c0-1.984,0-2.478,0-4.462c-0.85,0.124-1.695,0.238-2.539,0.336c0-1.135,0-0.776,0-1.911c0-0.181-0.15-0.929,0.109-0.979c0.771-0.153,1.545-0.311,2.32-0.476c0.365-0.078,0.109-2.588,0.109-2.911c0-1.096,0-2.193,0-3.29c-0.85,0.164-1.695,0.331-2.539,0.495c0-1.143,0-0.792,0-1.935c0-0.167-0.137-0.789,0.109-0.844c0.771-0.176,1.545-0.347,2.32-0.511c0.311-0.066,0.109-3.443,0.109-3.694c0-1.483,0-1.472,0-2.954c0-0.442-0.352-1.98,0.326-2.022c0.195-0.017,1.471-0.146,1.471-0.012c0,0.39,0,0.78,0,1.169c0,2.365,0,4.732,0,7.099c1.137-0.241,2.279-0.465,3.416-0.671c0.424-0.075,0.184-2.725,0.184-3.017c0-2.261,0-4.523,0-6.784c0.002-0.681,1.799-0.023,1.799-0.186c0,0.743,0,1.486,0,2.229c0,1.976,0,5.444,0,7.419C49.11,9.653,49.958,9.54,50.8,9.439c0,1.114,0,0.731,0,1.844c0,0.311,0.191,0.759-0.234,0.842c-0.756,0.149-1.514,0.305-2.273,0.467c-0.215,0.045-0.029,2.657-0.029,2.895c0,1.097,0,2.193,0,3.291c0.848-0.203,1.695-0.407,2.537-0.608c0,1.078,0,0.662,0,1.74c0,0.226,0.166,0.929,0,1.132c-0.189,0.234-1.604,0.432-1.947,0.519c-0.426,0.112-0.59,0.051-0.59,0.379c0,0.449,0,2.392,0,2.839c0,1.462,0-0.062,0,1.4c0,0.27,0.186,2.074-0.158,2.095c-0.172,0.016-1.639,0.111-1.641,0.047c0-0.32,0-0.643,0-0.964c0-2.249,0-1.509,0-3.759V22.104z M42.864,19.847c1.041-0.198,2.084-0.401,3.127-0.61c0.754-0.151,0.473-0.559,0.473-1.142c0-1.721,0-3.445,0-5.167c-1.041,0.195-2.084,0.4-3.125,0.608c-0.754,0.151-0.475,0.561-0.475,1.144C42.864,16.402,42.864,18.124,42.864,19.847z';
    paths['bassClef'] = 'M-47.089,46.128c9.131-6.105,14.94-9.484,20.041-18.379c2.193-3.855,3.795-9.37,3.795-13.4c0-3.26-0.179-5.691-1.423-8.062c-1.424-2.728-4.447-4.863-8.361-4.508c-2.607,0.238-5.751,1.188-7.055,2.61c-0.712,0.771-1.364,1.837-1.779,2.728c-0.355,0.771,0,1.956,1.421,2.016c0.536,0,1.722-0.474,2.375-0.534c3.081-0.354,5.631,2.134,5.631,4.803c0,2.61-2.312,5.336-5.988,5.336c-3.794,0-6.996-2.608-7.114-6.345c-0.118-3.972,2.489-8.004,6.166-10.019C-37.425,1.127-33.154,0-31.08,0c3.794,0,7.175,0.652,10.731,3.616c3.559,2.965,4.743,5.397,5.276,10.377c0.771,7.055-5.099,16.305-10.79,20.989c-5.336,4.387-13.519,8.834-20.87,12.391L-47.089,46.128z M-9.321,4.564c1.957,0,3.203,1.602,3.203,3.203c0,1.659-1.246,3.261-3.203,3.261c-2.073,0-3.261-1.602-3.261-3.261C-12.582,6.166-11.395,4.564-9.321,4.564z M-9.321,17.549c1.957,0,3.203,1.601,3.203,3.203c0,1.659-1.246,3.261-3.203,3.261c-2.073,0-3.261-1.602-3.261-3.261C-12.582,19.15-11.395,17.549-9.321,17.549z';
    paths['square'] = 'M26.125,4.304L4.5,5.039L3.509,26.116l24.616,2.25L26.125,4.304z M20.812,22.179L8.125,20.741L9,10.054l11.812-2.688V22.179z';

    for(var i in paths)
    {
        var sgSvg = new SGSvg();
        sgSvg.path = i;
        var lines = sgSvg.parser(paths[i]);
        var dots = sgSvg.linesToNormalizeDots(lines);
        var objectiveCLines = sgSvg.dotsToObjectiveCLines(dots);
        var objectiveCCode = sgSvg.writeToObjectiveC(objectiveCLines);
        sgSvg.writeObjectiveCToFile(objectiveCCode, i);
    }
}

var SGSvg = function(){
    this.maxX = 0;
    this.maxY = 0;
    this.lastX = 0;
    this.lastY = 0;
    this.offsetX = 1000;
    this.offsetY = 1000;
    this.nPoint = 5;
    this.extra = 1.5;
    this.path = '';
};

SGSvg.prototype.parser = function(svgString) {

    var processedBassClefPath = svgString.replace(/([a-zA-Z])/g,"|$1%");
    processedBassClefPath = processedBassClefPath.replace(/(\d)(-)/g,'$1,$2');
    return processedBassClefPath.split("|");
};

SGSvg.prototype.linesToNormalizeDots = function(lines) {

    var dots = [];
    for(var i in lines) {

        var divider = lines[i].split("%");
        if (divider[0] && divider[1]) {
            $this = this;
            var axises = [];
            divider[1].split(',').forEach(function(val,index){
                var scales = [];
                scales['bassClef'] = 0.85;

                if (typeof(scales[$this.path]) !== 'undefined') {
                    axises.push(val * scales[$this.path]);
                }
            });

            var dot = {};
            dot.action = divider[0];

            // relative calc
            if(/[a-y]/.test(dot.action)) {

                // extra attribute
                if (dot.action === 'c') {
                    dot.x1 = this.lastX + (axises[0]*1);
                    dot.y1 = this.lastY + (axises[1]*1);
                    dot.x2 = this.lastX + (axises[2]*1);
                    dot.y2 = this.lastY + (axises[3]*1);
                    dot.x0 = this.lastX + (axises[4]*1);
                    dot.y0 = this.lastY + (axises[5]*1);
                    
                } else {
                    dot.x0 = this.lastX + (axises[0]*1);
                    dot.y0 = this.lastY + (axises[1]*1);
                }


            } else if(/[A-Y]/.test(dot.action)) {

                if (dot.action === 'C') {
                    dot.x1 = (axises[0]*1);
                    dot.y1 = (axises[1]*1);
                    dot.x2 = (axises[2]*1);
                    dot.y2 = (axises[3]*1);
                    dot.x0 = (axises[4]*1);
                    dot.y0 = (axises[5]*1);
                } else if (dot.action === 'V') {
                    dot.x0 = this.lastX;
                    dot.y0 = (axises[1]*1);
                } else {
                    dot.x0 = (axises[0]*1);
                    dot.y0 = (axises[1]*1);
                }

            } else {
                if (dot.action.toUpperCase()!=='Z') {
                    throw dot.action+' not handle';
                }
                dot.x0 = 0;
                dot.y0 = 0;
            }

            dot.action = dot.action.toUpperCase();

            if (dot.action.toUpperCase()!=='Z') {
                if (this.maxX < dot.x0) {
                    this.maxX = dot.x0;
                }
                if (this.maxY < dot.y0) {
                    this.maxY = dot.y0;
                }
                if (this.offsetX > dot.x0) {
                    this.offsetX = dot.x0;
                }
                if (this.offsetY > dot.y0) {
                    this.offsetY = dot.y0;
                }
            }

            this.lastX = dot.x0;
            this.lastY = dot.y0;
            dots.push(dot);
        }
    }
    return dots;
};

SGSvg.prototype.dotsToObjectiveCLines = function(dots) {
    this.offsetX = this.offsetX.roundNumber(this.nPoint) - this.extra;
    this.offsetY = this.offsetY.roundNumber(this.nPoint) - this.extra;
    var lines = [];
    for(var i in dots) {
        var dot = dots[i];
        if (dot.action === 'M') {
            lines.push('CGContextMoveToPoint(ctx, [self scale:'+(dot.x0-this.offsetX).roundNumber(this.nPoint)+'], [self scale:'+(dot.y0-this.offsetY).roundNumber(this.nPoint)+']);');
        } else if (dot.action === 'C') {
            lines.push('CGContextAddCurveToPoint (ctx, [self scale:'+(dot.x1-this.offsetX).roundNumber(this.nPoint)+'], [self scale:'+(dot.y1-this.offsetY).roundNumber(this.nPoint)+'], [self scale:'+(dot.x2-this.offsetX).roundNumber(this.nPoint)+'], [self scale:'+(dot.y2-this.offsetY).roundNumber(this.nPoint)+'], [self scale:'+(dot.x0-this.offsetX).roundNumber(this.nPoint)+'], [self scale:'+(dot.y0-this.offsetY).roundNumber(this.nPoint)+']);');
        } else if (dot.action === 'L') {
            lines.push('CGContextAddLineToPoint(ctx, [self scale:'+(dot.x0-this.offsetX).roundNumber(this.nPoint)+'], [self scale:'+(dot.y0-this.offsetY).roundNumber(this.nPoint)+']);');
        } else if (dot.action === 'Z') {
            // lines.push(
            //     "CGContextClosePath (ctx);\n"+
            //     "    if (fillPath) {\n"+
            //     "        CGContextEOFillPath(ctx);\n"+
            //     "    }\n"+
            //     "    CGContextStrokePath(ctx);\n"
            // );
        }
    }
    lines.push(
        "CGContextClosePath (ctx);\n"+
        "    CGContextEOFillPath(ctx);\n"+
        "    //CGContextStrokePath(ctx);\n"
    );
    return lines;
};

SGSvg.prototype.writeToObjectiveC = function(lines) {
    this.maxX += this.extra;
    this.maxY += this.extra;
    var result = "\n"+
        "@synthesize scale = _scale;\n"+
        "- (id)initWithX:(CGFloat)x y:(CGFloat)y scale:(CGFloat)s\n"+
        "{\n"+
        "    self = [self initWithFrame:CGRectMake(x, y, s * "+(this.maxX-this.offsetX).roundNumber(this.nPoint)+", s * "+(this.maxY-this.offsetY).roundNumber(this.nPoint)+")];\n"+
        "    if (self) {\n"+
        "        [self setBackgroundColor:[UIColor colorWithWhite:0 alpha:0]];\n"+
        "        self.scale = s;\n"+
        "    }\n"+
        "    return self;\n"+
        "}\n\n"+
        "- (id)initWithFrame:(CGRect)frame\n"+
        "{\n"+
        "    self = [super initWithFrame:frame];\n"+
        "    if (self) {\n"+
        "    }\n"+
        "    return self;\n"+
        "}\n\n"+
        "-(void) drawRect:(CGRect)rect {\n"+
        "    CGContextRef ctx = UIGraphicsGetCurrentContext();\n"+
        "    CGContextSetRGBFillColor(ctx, 0, 0, 0, 1 );\n"+
        "    //CGContextSetRGBStrokeColor(ctx, 1, 1, 1, 1); \n"+
        "    CGContextSetLineWidth(ctx, 1);\n";

    for(var i in lines) {
        result += "    "+lines[i]+"\n";
    }
    result += "}\n\n";
    result += "-(CGFloat)scale:(CGFloat)s {\n";
    result += "    return s * self.scale;\n";
    result += "}\n\n";
    result += "@end";
    return result;
};

SGSvg.prototype.writeObjectiveCToFile = function(content, filename) {
    var fs = require('fs');
    fs.writeFile(filename+".m", content , function(err) {
        if(err) {
            console.log(err);
        } else {
            console.log("The file was saved!");
        }
    });
}

Number.prototype.roundNumber = function(digits) {
    var multiple = Math.pow(10, digits);
    return Math.round(this * multiple) / multiple;
}
main();